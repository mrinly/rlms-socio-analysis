---
title: ''
output:
  word_document: default
  pdf_document:
    latex_engine: xelatex
  html_document:
    df_print: paged
header-includes:
- \usepackage{fontspec}
- \usepackage[russian]{babel}
- \setmainfont{Arial}
---

# Семья и работа

#### Тема: Влияет ли семейный статус на вероятность трудоустройства?

### 1. Загрузка и подготовка данных.

```{r}
library(haven)
data_2022 <- read_dta('r31i_os_75.dta') #Читаем данные
```

### 2. Фильтрация данных.

Выбираем только людей от 25 до 45 включительно. 

```{r}
data_2022 <- data_2022[data_2022$aa_age >= 25 & data_2022$aa_age <= 45,] 
```

По статусу занятости фильтруем тех, кто работает. 

```{r}
data_2022$job_status[data_2022$aaj1 == 1] <- 1 #работают
data_2022$job_status[data_2022$aaj1 != 1 & data_2022$aaj1 != 99999997 & data_2022$aaj1 != 99999998 & data_2022$aaj1 != 99999999]<- 0 #на данный момент без работы, в декрете или отпуске
```

• *Переменная семейного положения*

– Женатые/замужние (официально зарегистрированный брак);

– Неженатые/незамужние (включая вдовых, разведённых, никогда не состоявших в браке).

```{r}
data_2022$marriage[data_2022$aa_marst == 2 | data_2022$aa_marst == 6] <- 1 # в зарегистрированном браке
data_2022$marriage[data_2022$aa_marst == 1 | data_2022$aa_marst == 3 | data_2022$aa_marst == 4 | data_2022$aa_marst == 5] <- 0 # не в браке на данный момент
```

Запишем все данные в 4 переменные. 

```{r}
job <- data_2022$job_status #создаем переменную со статусом работы (1 или 0)
marriage <- data_2022$marriage #создаем переменную со статусом замужества (1 или 0)
age <- data_2022$aa_age #создаем переменную с возрастом
gender <- data_2022$aah5 #создаем переменную с полом
```

### 3 Расчет долей.

• *Рассчитаем долю трудоустроенных среди женатых/замужних p1;*

```{r}
#расчет отношения трудоустроенных среди замужних/женатых ко всему количеству женатых

#выбираем те строки, где объект и в браке (статус 1), и работает (статус 1)
married_employed <- data_2022[data_2022$marriage == 1 & data_2022$job_status == 1,] 

total_married <- data_2022[data_2022$marriage == 1,] #выбираем те строки, где объект в браке (1)

#считаем количество соответствующих строк (объектов)
r_1 <- nrow(married_employed) 
print(r_1)
n_1 <- nrow(total_married)
print(n_1)
p_1 <- r_1/ n_1
paste('Доля трудоустроенных среди женатых/замужних:', p_1)
```

• *Рассчитаем долю трудоустроенных среди неженатых/незамужних p2.*

```{r}
#расчет отношения трудоустроенных среди незамужних/неженатых ко всему количеству людей не в браке

#выбираем те строки, где объект не в браке(статус 0), но при этом работает (статус 1)
single_married <- data_2022[data_2022$marriage == 0 & data_2022$job_status == 1,]
total_single <- data_2022[data_2022$marriage == 0,] #выбираем строки, где объект не состоит в браке

#считаем количество соответствующих строк (объектов)
r_2 <- nrow(single_married)
print(r_2)
n_2 <- nrow(total_single)
print(n_2)
p_2 <- r_2/ n_2
paste('Доля трудоустроенных среди неженатых/незамужних:', p_2)
```

### 4. Построение доверительного интервала для разности долей.

• *Построим доверительный интервал для разности долей трудоустроенных между женатыми/замужними и нет для уровней значимости 90%, 95% и 99%.*

```{r}
print(n_1)
print(n_2)

#так как обе выборки большие >1000 объектов, то критические значения будем брать, пользуясь графиком нормального распределения
z_90 <- 1.64 #критические значения для разных уровней значимости
z_95 <- 1.96
z_99 <- 2.57

#разница между двумя долями
difference = p_2 - p_1

#построение доверительных интервалов для каждого уровня значимости (ci - confidence interval)
#рассчитаем по отдельности левые и правые границы интервалов

ci_90_left <- difference - z_90 * sqrt(p_1*(1 - p_1)/n_1 + p_2*(1 - p_2)/n_2)
ci_90_right <- difference + z_90 * sqrt(p_1*(1 - p_1)/n_1 + p_2*(1 - p_2)/n_2)
ci_95_left <- difference - z_95 * sqrt(p_1*(1 - p_1)/n_1 + p_2*(1 - p_2)/n_2)
ci_95_right <- difference + z_95 * sqrt(p_1*(1 - p_1)/n_1 + p_2*(1 - p_2)/n_2)
ci_99_left <- difference - z_99 * sqrt(p_1*(1 - p_1)/n_1 + p_2*(1 - p_2)/n_2)
ci_99_right <- difference + z_99 * sqrt(p_1*(1 - p_1)/n_1 + p_2*(1 -p_2)/n_2)

ci_90 <- sprintf("Confidence interval (%.3f, %.3f)", ci_90_left, ci_90_right)
print(ci_90)
ci_95 <- sprintf("Confidence interval (%.3f, %.3f)", ci_95_left, ci_95_right)
print(ci_95)
ci_99 <- sprintf("Confidence interval (%.3f, %.3f)", ci_99_left, ci_99_right)
print(ci_99)
print(difference)
```

• *Вывод*

По результатам построения доверительных интервалов для каждого из 3 уровней значимости получилось, что 0 содержится в каждом из них. Иными словами, если брать другие выборки, то в 90%, 95% и 99% из них, соответственно, доверительный интервал "поймает" 0. Таким образом, можно заключить, что разрыва между долями трудоустроенных среди людей в браке и трудоустроенных среди незамужних и неженатых нет.

### 5. Проверка гипотезы о равенстве долей.

##### 1. *Формулировка гипотез:*

**Нулевая гипотеза**: доли трудоустроенных среди замужних/женатых и среди незамужних/неженатых равны (не различаются) (**H_0: П_1 = П_2**)

**Альтернативная гипотеза**: эти доли различаются (**H1: П_1** $\neq$ П_2)

##### 2. *Выбор и расчет тестовой статистики:*

Альтернативная гипотеза подразумевает неравенство, значит критерий будет *двусторонним*. Выборки большие (количество указано выше), значит используем z-значение (то есть смотрим на график нормального распределения).

Воспользуемся формулой для **тестовой статистики** для сравнения двух долей генеральных совокупностей: $z = \frac{(p_1 - p_2 - (П_1 - П_2))}{\sqrt{(P*(1 - P)*(\frac{1}{n_1} + \frac{1}{n_2}))}}$. Статистика является стандартной нормальной величиной.

```{r}
#оцениваем совокупную долю 

P <- (r_1 + r_2) / (n_1 + n_2)

#так как в H_0 полагаем равенство долей генеральных совокупностей, то П_1 - П_2 = 0

Z <- difference / sqrt(P*(1 - P)*(1 /n_1 + 1/n_2))

paste('Значение тестовой статистики равно:', Z)

```

##### 3. *Критическая область.

В случае двустороннего критерия критические значения будут точно такими же, как и в пункте с доверительными интервалами.

$z = 0,11975$, Z не попала в критическую область на уровне значимости 10%. Значит, Z не попала и в другие критические области (при уровнях значимости 5% и 1%). Таким образом, H0 не может быть отвергнута при всех $\alpha$.

##### 4. *Интерпретация*

Исходя из того, что H0 не отвергается, можно подтвердить, что различия между долями нет, то есть семейный статус не влияет на занятость.

С социальной точки зрения, это может означать следующее:

-   **Экономическая независимость**: Как замужние/женатые, так и незамужние/неженатые люди достигают уровня экономической независимости, позволяющей им активно участвовать в трудовом рынке. В каждой группе могут быть люди, стремящиеся к карьерным достижениям и финансовой обеспеченности независимо от их семейного положения.

-   **Изменение семейных норм**: Параллельная трудовая активность может свидетельствовать о смене традиционных представлений о семье и браке. В современном обществе все чаще происходит осознание того, что брак не является необходимым условием для обеспечения материального благополучия.

### 5 Сравнение по полу.

Повторим весь анализ отдельно для мужчин и для женщин:

• *Разделим выборку на мужчин и женщин.*

```{r}
#фильтруем строки,в которых объект - женатый мужчина с работой 
man_married_employed <- data_2022[data_2022$marriage == 1 & data_2022$aah5 == 1 & data_2022$job_status == 1,]

#фильтруем строки, в которых объект - женатый мужчина
man_total_married <- data_2022[data_2022$marriage == 1 & data_2022$aah5 == 1,]

#фильтруем строки,в которых объект - неженатый мужчина с работой 
man_single_employed <- data_2022[data_2022$marriage == 0 & data_2022$aah5 == 1 & data_2022$job_status == 1,]

#фильтруем строки, в которых объект - неженатый мужчина
man_total_single<- data_2022[data_2022$marriage == 0 & data_2022$aah5 == 1,]

#фильтруем строки,в которых объект - замужняя женщина с работой 
woman_married_employed <- data_2022[data_2022$marriage == 1 & data_2022$aah5 == 2 & data_2022$job_status == 1,]

#фильтруем строки, в которых объект - замужняя женщина
woman_total_married <- data_2022[data_2022$marriage == 1 & data_2022$aah5 == 2,]

#фильтруем строки,в которых объект - незамужняя женщина с работой 
woman_single_employed <- data_2022[data_2022$marriage == 0 & data_2022$aah5 == 2 & data_2022$job_status == 1,]

#фильтруем строки, в которых объект - незамужняя женщина
woman_total_single<- data_2022[data_2022$marriage == 0 & data_2022$aah5 == 2,]
```

**Мужчины:**

```{r}
#считаем количество подходящих строк (объектов) 
n_3 <- nrow(man_total_married) 
print(n_3)
r_3 <- nrow(man_married_employed) 
print(r_3)
p_3 <- r_3 / n_3

paste('Доля трудоустроенных среди женатых мужчин составляет:', p_3)

n_4 <- nrow(man_total_single)
print(n_4)
r_4 <- nrow(man_single_employed) 
print(r_4)
p_4 <- r_4 / n_4 
paste('Доля трудоустроенных среди неженатых мужчин составляет:', p_4)

```

Сформулируем гипотезы. **H0: П_3 = П_4** (между долями трудоустроенных женатых мужчин и трудоустроенных неженатых мужчин *разницы нет*) и **H1: П_3** $\neq$ **П_4** (разница есть).

```{r}
print(n_3) 
print(n_4) 
```

Так как выборки большие, используем график нормального распределения для определения критического значения.

```{r}
P_m <- (r_3 + r_4) / (n_3 + n_4) 

Z_m <- (p_3 - p_4) / sqrt(P_m*(1 - P_m)*(1 /n_3 + 1/n_4)) 

paste('Значение тестовой статистики равно:', Z_m)
```

**Женщины:**

```{r}
#считаем количество подходящих строк (объектов) 

n_5 <- nrow(woman_total_married) 
print(n_5)
r_5 <- nrow(woman_married_employed) 
print(r_5)
p_5 <- r_5 / n_5 
paste('Доля трудоустроенных среди замужних женщин составляет:', p_5)

n_6 <- nrow(woman_total_single) 
print(n_6)
r_6 <- nrow(woman_single_employed)
print(r_6)
p_6 <- r_6 / n_6 
paste('Доля трудоустроенных среди незамужних женщин составляет:', p_6)
```

Сформулируем гипотезы. **H0: П_5 = П_6** (между долями трудоустроенных замужних женщин и трудоустроенных незамужних женщин *разницы нет*) и **H1: П_5** $\neq$ П_6 (*разница есть*).

```{r}
print(n_5)
print(n_6)
```

Так как выборки большие, используем график нормального распределения для определения критического значения.

```{r}
P_w <- (r_5 + r_6) / (n_5 + n_6) 

Z_w <- (p_5 - p_6) / sqrt(P_w*(1 - P_w)*(1 /n_5 + 1/n_6))

paste('Значение тестовой статистики равно:', Z_w)
```

• *Сравнение результатов*

При уровне значимости 1% H0 отвергается в пользу альтернативной гипотезы H1, то есть в подгруппах наблюдается разница между долями трудоустроенных с разным семейным положением. При этом если смотреть на односторонние критерии, то для мужчин принимается альтернативная гипотеза, что доля занятых среди женатых выше, чем доля среди неженатых, а для женщин - наоборот. Доля среди замужних ниже, чем доля среди незамужних.

• *Возможные причины различий*

В культуре существует стереотип, что женатые мужчины являются главами семейства и имеют большую ответственность за финансовое обеспечение. Это может приводить к тому, что более высокие доли женатых мужчин показывают более высокую занятость. При этом, замужние женщины, наоборот, могут сталкиваться с ожиданиями, связанными с домашними обязанностями, что ограничивает возможности занятости.

Замужние женщины могут нести больше ответственности за уход за детьми или другими родственниками, что сказывается на их трудовой занятости. Это может приводить к более низкой доле замужних женщин среди трудоустроенных. В то же время женатые мужчины могут восприниматься как имеющие меньше таких обязанностей, что поддерживает их присутствие на рынке труда.

Таких же ожиданий могут придерживаться работодатели, полагая, что замужняя женщина вскоре уйдет в декрет и на время будет удалена от работы. За мужчинами же декретный отпуск является исключением, что может приводить к тому, что работодатели более охотно их нанимают.

